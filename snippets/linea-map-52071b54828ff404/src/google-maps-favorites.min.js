const MARKERS_PATH={PASSENGER:"assets/passenger-marker-icon-64x64.png"},SHAPE_TYPES={PASSENGER:"passenger",PIN:"pin"};let map=null,passengerMarker=null,follow=!0,searchBox=null,storedInitialPosition=null,mapZoom=17,userType=null,prevPassengerPosition=null,storedPassengerPos=null,pinMarker=null;function setMapToNull(){map=null,passengerMarker=null,follow=!0,searchBox=null,userType=null,prevPassengerPosition=null,storedPassengerPos=null,cleanPrecisionPin()}function CenterControl(e,n){var o=document.createElement("div"),a=(o.className="mt-1",e.appendChild(o),document.createElement("div")),t=(e.appendChild(a),document.createElement("div")),e=(t.className="mt-1",e.appendChild(t),document.createElement("BUTTON")),e=(e.setAttribute("id","google-map-zoom-in"),e.innerHTML='<i class="fas fa-2x fa-plus text-new-purple "></i>',e.onclick=function(e){follow=!1;var o=n.getZoom();mapZoom=o+1,n.setZoom(mapZoom)},o.appendChild(e),document.createElement("div")),o=(e.className="divider-line",o.appendChild(e),document.createElement("BUTTON")),e=(o.setAttribute("id","google-map-zoom-out"),o.innerHTML='<i class="fas fa-2x fa-minus text-new-purple "></i>',o.onclick=function(e){var o=n.getZoom();0!=o&&(follow=!1,mapZoom=o-1,n.setZoom(mapZoom))},a.appendChild(o),document.createElement("div")),o=(e.className="divider-line",a.appendChild(e),document.createElement("BUTTON"));o.setAttribute("id","google-map-location-toggle"),o.innerHTML='<i class="fas fa-2x fa-crosshairs text-new-purple "></i>',o.onclick=function(e){follow||(null!=pinMarker?centerCameraFollow(pinMarker.position):(follow=!0,storedPassengerPos&&centerCameraFollow(new google.maps.LatLng(storedPassengerPos.coords.latitude,storedPassengerPos.coords.longitude))))},t.appendChild(o)}async function updateMap(e){var o;!e||prevPassengerPosition&&prevPassengerPosition.coords.longitude===e.coords.longitude&&prevPassengerPosition.coords.latitude===e.coords.latitude||(o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),prevPassengerPosition=e,passengerMarker?updateMarkerPosition(passengerMarker,o):passengerMarker=createShape(SHAPE_TYPES.PASSENGER,o),follow&&centerCamera(o))}function renderMap(o,n,a){if(console.log(`passenger-pos ${JSON.stringify(n)}, initial-pos `+JSON.stringify(a)),map)null===passengerMarker&&createPinMarker(new google.maps.LatLng(n.latitude,n.longitude)),updateMap(storedPassengerPos=n);else{let e=new google.maps.LatLng(13.7111843,-89.2559122);storedInitialPosition={latitude:13.7111843,longitude:-89.2559122},void 0!==a?(e=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),storedInitialPosition={latitude:a.coords.latitude,longitude:a.coords.longitude}):null!==n&&(e=new google.maps.LatLng(n.coords.latitude,n.coords.longitude),storedInitialPosition={latitude:n.coords.latitude,longitude:n.coords.longitude}),storedPassengerPos=n,map=new google.maps.Map(o,{zoom:mapZoom,center:e,mapId:"7acc69eff5c134dc",disableDefaultUI:!0});a=document.createElement("div");a.setAttribute("id","google-map-controls"),CenterControl(a,map),map.controls[google.maps.ControlPosition.LEFT_CENTER].push(a),searchBox=new google.maps.places.PlacesService(map),map.addListener("drag",function(){follow=!1}),map.addListener("zoom_changed",function(){follow=!1})}}function createPinMarker(e){var o;e&&(o=new google.maps.InfoWindow({content:"<strong>Ubicación Actual</strong>",disableAutoPan:!0}),(passengerMarker=new google.maps.Marker({position:e,icon:{url:"assets/location-round.svg",origin:new google.maps.Point(0,0),scaledSize:new google.maps.Size(20,20),anchor:new google.maps.Point(10,10)},map:map})).addListener("click",()=>{o.open(map,passengerMarker)}))}function centerCamera(e){map&&e&&(map.panTo(e),setTimeout(()=>{map&&map.setZoom(mapZoom)},1e3))}function centerCameraFollow(e){map&&e&&(map.panTo(e),setTimeout(()=>{map&&map.setZoom(17)},1e3),mapZoom=17)}function createShape(e,o){if(map)return e===SHAPE_TYPES.PASSENGER?new google.maps.Marker({icon:{url:"assets/passenger-marker-icon-64x64.png",scaledSize:new google.maps.Size(40,40)},position:o,map:map}):e===SHAPE_TYPES.PIN?new google.maps.Marker({position:o,animation:google.maps.Animation.DROP,draggable:!1,map:map}):void 0}function updateMarkerPosition(e,o){e&&e.setPosition(o)}function getPlaceInfoFromCoordinates(e,s){map&&(e=new google.maps.LatLng(e.latitude,e.longitude),(new google.maps.Geocoder).geocode({location:e}).then(e=>{if(e.results[0]){let o="";var l=e.results[0].formatted_address;let n="",a="",t="";e.results[0].address_components.map(e=>{e.types.some(e=>"administrative_area_level_2"===e)&&(t=e.long_name),e.types.some(e=>"political"===e&&"sublocality"===e||"sublocality_level_1"===e)&&(o=e.long_name),e.types.some(e=>"locality"===e||"administrative_area_level_2"===e)&&(n=e.long_name),e.types.some(e=>"administrative_area_level_1"===e)&&(a=e.long_name)}),s([l,n,a,t,o])}else s(["Aquí","","","",""])}).catch(e=>console.log("Geocoder failed due to: "+e)))}function initializePrecisionPin(e,o){setPrecisionPin(storedInitialPosition,e,o)}function setPrecisionPin(e,o,n){map&&e?(e=new google.maps.LatLng(e.latitude,e.longitude),map.addListener("dragend",function(){follow,o([map.getCenter().lat(),map.getCenter().lng()])}),o([map.getCenter().lat(),map.getCenter().lng()]),follow&&(map.panTo(e),map.setZoom(17)),follow=!1):n()}function cleanPrecisionPin(){pinMarker&&(pinMarker.setMap(null),pinMarker=null)}let autocomplete=null,searchInputId=null;function cleanSearchVariables(){document.querySelectorAll(".pac-container").forEach(e=>{e.remove()}),autocomplete=null,searchInputId=null}function searchSetup(e,o,m){var n;null!=autocomplete&&searchInputId==e.id||(document.querySelectorAll(".pac-container").forEach(e=>{e.remove()}),searchInputId=e.id,n={strictBounds:!1,componentRestrictions:{country:"sv"}},autocomplete=new google.maps.places.Autocomplete(e,n),(new google.maps.InfoWindow).setContent(o)),autocomplete.addListener("place_changed",()=>{var e=autocomplete.getPlace();console.log(e);let o="undefined",n="undefined",a="undefined",t,l="undefined",s="undefined",i="undefined",r="undefined";t=e.formatted_address,e.address_components.map(e=>{e.types.some(e=>"country"===e)&&(o=e.long_name,n=e.short_name),e.types.some(e=>"administrative_area_level_1"===e)&&(a=e.long_name),e.types.some(e=>"street_number"===e||"route"===e)&&(r+=e.long_name+" "),e.types.some(e=>"locality"===e||"administrative_area_level_2"===e)&&(s=e.long_name,l=e.long_name),i=e.types.some(e=>"sublocality_level"===e||"sublocality"===e)?e.long_name:""});var p=new google.maps.Data.Feature({geometry:new google.maps.Data.Point(e.geometry.location),id:e.place_id,properties:{address:{country:o,country_code:n,country_subdivision:a,freeform_address:t,local_name:l,municipality:s,city:i,street_name:r},type:e.types[0],poi:{name:e.name}}});map.panTo(e.geometry.location);let c;p.toGeoJson(e=>{c=JSON.stringify(e),console.log(c),m(c)})})}export{map,passengerMarker,follow,searchBox,setMapToNull,renderMap,getPlaceInfoFromCoordinates,initializePrecisionPin,setPrecisionPin,cleanPrecisionPin,cleanSearchVariables,searchSetup};