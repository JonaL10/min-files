const MARKERS_PATH={PASSENGER:"assets/passenger-marker-icon-64x64.png",DRIVER:"assets/vehicle-marker-new.png"},SHAPE_TYPES={PASSENGER:"passenger",DRIVER:"driver",PIN:"pin"},VIEW_TYPES={VIEW_ROUTE:"view_route",TRIP:"trip"};let map=null,driverMarker=null,passengerMarker=null,follow=!0,followRoute=!1,prevRouteBegin=null,prevRouteEnd=null,searchBox=null,rotateMap=!1,mapZoom=17,userType=null,viewType=VIEW_TYPES.VIEW_ROUTE,prevPassengerPosition=null,lastFourDriverPositions=[],numberDriverPosition=0,prevDriverPosition=null,storedPassengerPos=null,storedDriverPos=null,routeChanged=!1,routeDistance=null,travelTime=null,timeRouteStored=null,distanceRouteStored=null,storedDriversLocations=[],driverMarkers=[],distanceService=null,directionsService=null,routeRenderer=null,pinMarker=null,pinPointMarker=null,screenBounds=0,centerMapTimeout=null,pickupPointCircle=null,lastHeadingDriverMarker=0,firstRoute=null,directionsServiceRequestCount=0,distanceServiceRequestCount=0,routeRendererRequestCount=0,insertPickupPointMarker=null,insertDestinationPointMarker=null;const routeDeviationValidationRange=19.3;function Exceptions(e){}function getCountResquestservice(){var e=navigator.connection.downlink;return[directionsServiceRequestCount,distanceServiceRequestCount,routeRendererRequestCount,e]}function resetCountResquestservice(){directionsServiceRequestCount=0,distanceServiceRequestCount=0,routeRendererRequestCount=0}function setMapToNull(){map=null,userType=null,driverMarker=null,passengerMarker=null,prevPassengerPosition=null,prevDriverPosition=null,storedPassengerPos=null,storedDriverPos=null}function showPanelDirection(){var e,o;null===document.getElementById("directions-step-map")&&((e=document.createElement("div")).setAttribute("class","card p-1"),e.setAttribute("id","directions-step-map"),(o=document.createElement("p")).setAttribute("id","p-instructions"),e.appendChild(o),document.body.appendChild(e))}function removePanelDirection(){var e=document.getElementById("directions-step-map");null!==e&&e.remove()}function showPickupPointCircle(e){console.log("pickupPointCircle show ",e),map&&!pickupPointCircle&&e&&(pickupPointCircle=new google.maps.Circle({strokeColor:"#F62F6C",strokeOpacity:.3,strokeWeight:2,fillColor:"#FC6C9E",fillOpacity:.15,map:map,center:{lat:e.latitude,lng:e.longitude},radius:200}),console.log("pickupPointCircle ",pickupPointCircle))}function removePickupPointCircle(){pickupPointCircle&&(pickupPointCircle.setMap(null),pickupPointCircle.getMap()||(console.log("pickupPointCircle Remove",pickupPointCircle.getMap()),pickupPointCircle=null))}async function updateMap(e,o,t,r,n){var a;if(!o||prevPassengerPosition&&prevPassengerPosition.coords.longitude===o.coords.longitude&&prevPassengerPosition.coords.latitude===o.coords.latitude||(a=new google.maps.LatLng(o.coords.latitude,o.coords.longitude),prevPassengerPosition=o,passengerMarker&&!passengerMarker.getMap()&&pinMarker&&updateMarkerPosition(pinMarker,a),passengerMarker?updateMarkerPosition(passengerMarker,a):passengerMarker=createShape(SHAPE_TYPES.PASSENGER,a),follow&&e===SHAPE_TYPES.PASSENGER&&centerCamera(a)),!t||prevDriverPosition&&prevDriverPosition.coords.longitude===t.coords.longitude&&prevDriverPosition.coords.latitude===t.coords.latitude||(o=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),prevDriverPosition=t,driverMarker?updateMarkerPosition(driverMarker,o):driverMarker=createShape(SHAPE_TYPES.DRIVER,o),follow&&e===SHAPE_TYPES.DRIVER&&centerCamera(o)),r||n){let e,o=!1;!r||prevRouteBegin&&prevRouteBegin.longitude===r.longitude&&prevRouteBegin.latitude===r.latitude||(prevRouteBegin=r,e=new google.maps.LatLng(r.latitude,r.longitude),o=!0,routeChanged=!0,followRoute)||VIEW_TYPES.VIEW_ROUTE!=viewType||(followRoute=!0),!n||prevRouteEnd&&prevRouteEnd.longitude===n.longitude&&prevRouteEnd.latitude===n.latitude||(prevRouteEnd=n,e=new google.maps.LatLng(n.latitude,n.longitude),o=!0,routeChanged=!0,followRoute)||VIEW_TYPES.VIEW_ROUTE!=viewType||(followRoute=!0),r&&n&&routeChanged&&await updateRoute(r,n,null)}}function onDragMap(){follow=!1,followRoute=!1,rotateMap=!1}function LaunchWazeRoute(){var e;prevRouteBegin&&prevRouteEnd&&(e=`https://ul.waze.com/ul?from=ll.${prevRouteBegin.latitude}%2C${prevRouteBegin.longitude}&ll=${prevRouteEnd.latitude}%2C${prevRouteEnd.longitude}&navigate=yes`,console.log(e),window.location.href=e)}function LaunchGMapsRoute(){var e;prevRouteBegin&&prevRouteEnd&&(e=`https://www.google.com/maps/dir/?api=1&origin=${prevRouteBegin.latitude}%2C${prevRouteBegin.longitude}&destination=${prevRouteEnd.latitude}%2C${prevRouteEnd.longitude}&travelmode=driving&zoom=15`,console.log(e),window.location.href=e)}function CenterControl(e,t,o){var r=document.createElement("div"),n=(r.setAttribute("id","google-map-controls"),r.setAttribute("class","mt-1"),e.appendChild(r),(e=document.createElement("div")).className="mt-1",r.appendChild(e),document.createElement("div")),a=(r.appendChild(n),document.createElement("div")),i=(a.className="mt-1",r.appendChild(a),document.createElement("div"));r.appendChild(i),(r=document.createElement("BUTTON")).setAttribute("id","google-map-zoom-in"),r.innerHTML='<i class="fas fa-2x fa-plus  text-new-purple "></i>',r.onclick=function(e){follow=!1;var o=t.getZoom();mapZoom=o+1,t.setZoom(mapZoom)},e.appendChild(r),(i=document.createElement("div")).className="divider-line",e.appendChild(i),(r=document.createElement("BUTTON")).setAttribute("id","google-map-zoom-out"),r.innerHTML='<i class="fas fa-2x fa-minus text-new-purple "></i>',r.onclick=function(e){var o=t.getZoom();0!=o&&(follow=!1,mapZoom=o-1,t.setZoom(mapZoom))},n.appendChild(r),(e=document.createElement("div")).className="divider-line",n.appendChild(e),(i=document.createElement("BUTTON")).setAttribute("id","google-map-location-toggle"),i.innerHTML='<i class="fas fa-2x fa-crosshairs  text-new-purple "></i>',i.onclick=function(e){follow||(null!=pinMarker?centerCameraFollow(pinMarker.position):(follow=!0,followRoute=!1,rotateMap=!0,o===SHAPE_TYPES.PASSENGER?storedPassengerPos&&centerCameraFollow(new google.maps.LatLng(storedPassengerPos.coords.latitude,storedPassengerPos.coords.longitude)):storedDriverPos&&centerCameraFollow(new google.maps.LatLng(storedDriverPos.coords.latitude,storedDriverPos.coords.longitude))))},a.appendChild(i)}function followUser(){follow||null===userType||(follow=!0,userType===SHAPE_TYPES.PASSENGER?storedPassengerPos&&centerCameraFollow(new google.maps.LatLng(storedPassengerPos.coords.latitude,storedPassengerPos.coords.longitude)):storedDriverPos&&centerCameraFollow(new google.maps.LatLng(storedDriverPos.coords.latitude,storedDriverPos.coords.longitude)))}function sortFormatAddress(e){var o,t,r=e.split(",");return console.log("Place address: ",r),0<r.length&&r[0].includes("+")?(1<(o=r[0].split(" ")).length?(r.shift(),t=o.shift(),o.push(r),o.push(" "+t),o):(t=r.shift(),r.push(" "+t),r)).join(",").trim():e}function getPlaceInfoFromCoordinates(e,a){map&&(e=new google.maps.LatLng(e.latitude,e.longitude),(new google.maps.Geocoder).geocode({location:e}).then(e=>{if(e.results[0]){let o="";var n=sortFormatAddress(e.results[0].formatted_address);let t="",r="";e.results[0].address_components.map(e=>{e.types.some(e=>"political"===e&&"sublocality"===e||"sublocality_level_1"===e)&&(o=e.long_name),e.types.some(e=>"locality"===e||"administrative_area_level_2"===e)&&(t=e.long_name),e.types.some(e=>"administrative_area_level_1"===e)&&(r=e.long_name)}),a([n,t,r,o])}else a(["Aquí","","",""])}).catch(e=>console.log("Geocoder failed due to: "+e)))}function renderMap(o,t,r,n,e,a){if(map)userType!=t&&(userType=t,null!==passengerMarker&&(passengerMarker.setMap(null),passengerMarker=null),null!==driverMarker&&(driverMarker.setMap(null),driverMarker=null),userType===SHAPE_TYPES.PASSENGER?null===passengerMarker&&(i=new google.maps.LatLng(r.latitude,r.longitude),passengerMarker=createShape(SHAPE_TYPES.PASSENGER,i)):userType===SHAPE_TYPES.DRIVER&&null===driverMarker&&(i=new google.maps.LatLng(n.latitude,n.longitude),driverMarker=createShape(SHAPE_TYPES.DRIVER,i))),storedPassengerPos=r,storedDriverPos=n,!routeRenderer||e&&a||(routeRenderer.setMap(null),routeRendererRequestCount+=1,routeChanged=!1,routeDistance=null,a)||(prevRouteEnd=null,e)||(prevRouteBegin=null,follow&&(t===SHAPE_TYPES.PASSENGER?prevPassengerPosition=null:prevDriverPosition=null)),updateMap(t,storedPassengerPos,storedDriverPos,e,a);else{let e=new google.maps.LatLng(13.7111843,-89.2559122);t===SHAPE_TYPES.PASSENGER?null!==r&&(e=new google.maps.LatLng(r.coords.latitude,r.coords.longitude)):null!==n&&(e=new google.maps.LatLng(n.coords.latitude,n.coords.longitude),lastFourDriverPositions.push(e)),storedPassengerPos=r,storedDriverPos=n,map=new google.maps.Map(o,{zoom:mapZoom,center:e,mapId:"20445b526b3c70e5",disableDefaultUI:!0}),o.style.backgroundImage="none";var i=document.createElement("div");i.setAttribute("id","google-map-tool-bar"),CenterControl(i,map,t),map.controls[google.maps.ControlPosition.LEFT_CENTER].push(i),map.addListener("drag",function(){onDragMap()}),map.addListener("heading_changed",function(){var e=document.querySelector('img[src$="assets/vehicle-marker-new.png"]');null!=e&&(0==lastHeadingDriverMarker?e.style.transform="rotate("+-map.getHeading()+"deg)":e.style.transform="rotate("+(-map.getHeading()+lastHeadingDriverMarker)+"deg)")}),t===SHAPE_TYPES.DRIVER?driverMarker=createShape(SHAPE_TYPES.DRIVER,e):t===SHAPE_TYPES.PASSENGER&&(passengerMarker=createShape(SHAPE_TYPES.PASSENGER,e)),directionsService=new google.maps.DirectionsService,distanceService=new google.maps.DistanceMatrixService,routeRenderer=new google.maps.DirectionsRenderer,searchBox=new google.maps.places.PlacesService(map),userType=t}}function centerCamera(e){map&&e&&(map.panTo(e),setTimeout(()=>{map&&(1==follow?map.setZoom(17):map.setZoom(mapZoom))},1e3))}function centerCameraFollow(e){map&&e&&(map.panTo(e),setTimeout(()=>{map&&1==follow&&(map.setZoom(17),mapZoom=17)},1e3))}function createShape(e,o){var t;if(map)return e===SHAPE_TYPES.PASSENGER?(t=rotateMap?null:map,new google.maps.Marker({icon:{url:"assets/passenger-marker-icon-64x64.png",scaledSize:new google.maps.Size(40,40)},position:o,map:t})):e===SHAPE_TYPES.DRIVER?new google.maps.Marker({icon:{url:"assets/vehicle-marker-new.png",origin:new google.maps.Point(0,0),scaledSize:new google.maps.Size(40,40),anchor:new google.maps.Point(20,20)},position:o,map:map}):e===SHAPE_TYPES.PIN?new google.maps.Marker({position:o,icon:{url:"assets/location-round.svg",origin:new google.maps.Point(0,0),scaledSize:new google.maps.Size(20,20),anchor:new google.maps.Point(10,10)},map:map}):void 0}function setPinPointMarker(e,o){follow=!1,followRoute=!1,console.log(e);var e=new google.maps.LatLng(e[0],e[1]),t={path:"M12 0c-4.198 0-8 3.403-8 7.602 0 6.243 6.377 6.903 8 16.398 1.623-9.495 8-10.155 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.342-3 3-3 3 1.343 3 3-1.343 3-3 3z",strokeColor:"#fd3468",strokeOpacity:1,strokeWeight:2,fillColor:"#fd3468",fillOpacity:1,scale:1.2,origin:new google.maps.Point(0,0),scaledSize:new google.maps.Size(25,25),anchor:new google.maps.Point(12,24)};"purple"==o?(t.strokeColor="#2d164a",t.fillColor="#2d164a"):(t.strokeColor="#fd3468",t.fillColor="#fd3468"),map&&(pinPointMarker?(pinPointMarker.setIcon(t),pinPointMarker.setPosition(e)):pinPointMarker=new google.maps.Marker({position:e,icon:t,map:map}),map.panTo(e),1==follow)&&(map.setZoom(17),mapZoom=17)}function delPinPointMarker(){null!=pinPointMarker&&(pinPointMarker.setMap(null),pinPointMarker=null)}function showPinMarker(){follow=!1,followRoute=!1;var e,o=new google.maps.InfoWindow({content:"<strong>Ubicación Actual</strong>",disableAutoPan:!0});map&&!pinMarker&&prevPassengerPosition&&(e=new google.maps.LatLng(prevPassengerPosition.coords.latitude,prevPassengerPosition.coords.longitude),(pinMarker=createShape(SHAPE_TYPES.PIN,e)).addListener("click",()=>{o.open(map,pinMarker)}),o.open(map,pinMarker))}function hidePassengerMarker(){passengerMarker&&passengerMarker.setMap(null)}function showPassengerMarker(){var e;map&&(passengerMarker?passengerMarker.setMap(map):storedPassengerPos&&(e=new google.maps.LatLng(storedPassengerPos.latitude,storedPassengerPos.longitude),passengerMarker=createShape(SHAPE_TYPES.PASSENGER,e)))}function addLastDriverPosition(e){lastFourDriverPositions.includes(e)||(lastFourDriverPositions.length<4||lastFourDriverPositions.shift(),lastFourDriverPositions.push(e))}function updateMarkerPosition(e,o){var t,r,n;e&&(userType===SHAPE_TYPES.DRIVER&&"assets/vehicle-marker-new.png"==e.icon.url||"assets/vehicle-marker-new.png"==e.icon.url?(t=getInterpolateLocationAjust(o),0<lastFourDriverPositions.length?lastFourDriverPositions[0].equals(t.coords)||(r=google.maps.geometry.spherical.computeDistanceBetween(lastFourDriverPositions[0],t.coords),console.log("compute-distance ",r),.27<r&&null!=(r=document.querySelector('img[src$="assets/vehicle-marker-new.png"]'))&&(n=google.maps.geometry.spherical.computeHeading(lastFourDriverPositions[0],t.coords),console.log("MarkerRotation ",n),0==map.getHeading()?r.style.transform="rotate("+n+"deg)":r.style.transform="rotate("+(-map.getHeading()+n)+"deg)",1==rotateMap&&map.setHeading(n),lastHeadingDriverMarker=n,numberDriverPosition=0),numberDriverPosition+=1,addLastDriverPosition(t.coords)):addLastDriverPosition(t.coords),1==follow&&map.setZoom(17),e.setPosition(t.coords)):(1==follow&&map.setZoom(17),e.setPosition(o)),console.log(`updateMarkerPosition follow ${follow} followRoute `+followRoute))}function setPrecisionPin(e,o,t){map?(hidePassengerMarker(),e=new google.maps.LatLng(e.latitude,e.longitude),map.addListener("dragend",()=>{o([map.getCenter().lat(),map.getCenter().lng()])}),map.panTo(e),1==follow&&map.setZoom(17),o([map.getCenter().lat(),map.getCenter().lng()]),follow=!1):t()}function cleanPrecisionPin(){pinMarker&&(pinMarker.setMap(null),pinMarker=null,showPassengerMarker()),follow=!0}function updatePassengerMarkerPosition(e){map&&e&&(e=new google.maps.LatLng(e.latitude,e.longitude),passengerMarker?updateMarkerPosition(passengerMarker,e):passengerMarker=createShape(SHAPE_TYPES.PASSENGER,e))}function updateDriverMarkerPosition(e){map&&e&&(e=new google.maps.LatLng(e.latitude,e.longitude),driverMarker?updateMarkerPosition(driverMarker,e):driverMarker=createShape(SHAPE_TYPES.DRIVER,e))}async function getRouteDistanceAndTime(e,o,t,r){var n;e&&o&&t&&r&&({rows:e,status:n}=await distanceService.getDistanceMatrix({origins:[new google.maps.LatLng(e.latitude,e.longitude)],destinations:[new google.maps.LatLng(o.latitude,o.longitude)],travelMode:google.maps.TravelMode.DRIVING,durationInTraffic:!0}),"OK"==e[0].elements[0].status?(routeDistance=e[0].elements[0].distance.value,travelTime=e[0].elements[0].duration_in_traffic.value,t([routeDistance,travelTime])):r())}function checkDeviation(e,o){for(var t=Number.POSITIVE_INFINITY,r=0;r<o.length;r++){var n=o[r].location,n=google.maps.geometry.spherical.computeDistanceBetween(e,n);console.log("checkDeviation distance ",n,o),n<t&&(t=n)}return 50<t}function getInterpolateLocationAjust(e){var o,t,r=e,n=null;return{coords:null!=firstRoute&&1<firstRoute.overview_path.length&&1<(o=findClosestPoints(firstRoute,e)).length&&(t=interpolateLocation(e,o[0],o[1]),n=google.maps.geometry.spherical.computeHeading(o[0],o[1]),null!=driverMarker&&driverMarker.setPosition(t),google.maps.geometry.spherical.computeDistanceBetween(t,e)<routeDeviationValidationRange)?t:r,bearing:n}}function findClosestPoints(e,o){var t=[],r=e.overview_path;if(!(r.length<2))for(var n=google.maps.geometry.spherical.computeDistanceBetween(r[0],o),a=0;a<r.length-1;a++){var i=r[a],s=r[a+1],l=getProjection(o,i,s);l&&(l=google.maps.geometry.spherical.computeDistanceBetween(l,o))<n&&(n=l,t=[i,s])}return t}function getProjection(e,o,t){var r=e.lat()-o.lat(),e=e.lng()-o.lng(),n=t.lat()-o.lat(),a=t.lng()-o.lng(),i=n*n+a*a;return(r=0<i?(r*n+e*a)/i:-1)<0?o:1<r?t:new google.maps.LatLng(o.lat()+r*n,o.lng()+r*a)}function interpolateLocation(e,o,t){var r=(r=google.maps.geometry.spherical.computeDistanceBetween(e,o))/(r+google.maps.geometry.spherical.computeDistanceBetween(e,t)),r=Math.min(Math.max(r,0),1);return google.maps.geometry.spherical.interpolate(o,t,r)}async function updateRouteJS(e,o,t){var r,n,a,i,s=getInterpolateLocationAjust(new google.maps.LatLng(e.latitude,e.longitude)).coords,l=new google.maps.LatLng(o.latitude,o.longitude);map&&(r=await directionsService.route({origin:s,destination:l,travelMode:google.maps.TravelMode.DRIVING}),{status:n,rows:s}=(directionsServiceRequestCount+=1,await distanceService.getDistanceMatrix({origins:[s],destinations:[l],travelMode:google.maps.TravelMode.DRIVING,durationInTraffic:!0})),"OK"===r.status)&&(distanceServiceRequestCount+=1,firstRoute=r.routes[0],l=s[0].elements[0].distance.value,console.log("updateRouteJS element 0: ",s[0].elements[0]),a=Math.abs(routeDistance-l),i=.35*routeDistance,(routeDistance>l||a<=i||null==routeDistance||prevRouteEnd!=o)&&(routeDistance=l,travelTime=s[0].elements[0].duration_in_traffic.value,t&&t(travelTime),routeRenderer.setOptions({directions:r,map:map,suppressMarkers:!0,preserveViewport:!0,polylineOptions:{clickable:!1,strokeColor:"#ac90f4",strokeWeight:7,strokeOpacity:1}})),prevRouteBegin=e,prevRouteEnd=o,routeRendererRequestCount+=1,!0===followRoute&&(centerRoute(),followRoute=!1),routeChanged=!1)}async function updateRoute(e,o,t){e&&o&&!prevRouteBegin&&!prevRouteEnd||e&&o&&VIEW_TYPES.VIEW_ROUTE==viewType?await updateRouteJS(e,o,t):e&&o&&(e.latitud==prevRouteBegin.latitud&&e.longitude==prevRouteBegin.longitude&&o.latitud==prevRouteEnd.latitud&&o.longitude==prevRouteEnd.longitude||await updateRouteJS(e,o,t))}function centerRoute(){var e;map&&routeRenderer&&0!==routeRenderer.getDirections().routes.length&&(followRoute=!1,e=routeRenderer.getDirections().routes[0].bounds,routeRendererRequestCount+=1,map.fitBounds(e,screenBounds),17<map.getZoom()&&1==follow&&map.setZoom(17),e=map.getZoom(),mapZoom=e)}function focusUser(){follow=!0}function setMapBounds(e){switch(e){case VIEW_TYPES.VIEW_ROUTE:viewType=VIEW_TYPES.VIEW_ROUTE,screenBounds={top:screen.height/3,bottom:.1*screen.height};break;case VIEW_TYPES.TRIP:viewType=VIEW_TYPES.TRIP,screenBounds={top:.1*screen.height,bottom:screen.height/3};break;default:firstRoute=null,screenBounds=0}}function focusRoute(){followRoute=!0}function enableRotateMap(){rotateMap=!0}function disableRotateMap(){rotateMap=!1}function getRouteDistance(){return routeDistance?(console.log("ROUTEDISTANCE: "+routeDistance),routeDistance):-1}function getTravelTime(){return console.log("RideCardContent travelTime :",travelTime),travelTime||-1}async function getRouteTravelTimeWithCallback(e,o,t){e=(await distanceService.getDistanceMatrix({origins:[new google.maps.LatLng(e.latitude,e.longitude)],destinations:[new google.maps.LatLng(o.latitude,o.longitude)],travelMode:google.maps.TravelMode.DRIVING,durationInTraffic:!0})).rows,distanceServiceRequestCount+=1,"OK"!==e[0].elements[0].status?t(JSON.stringify({time:-1,distance_km:""})):(console.log("distanceService ",e[0].elements[0].distance.value),o={distance_km:e[0].elements[0].distance.text,distance:e[0].elements[0].distance.value,time:e[0].elements[0].duration_in_traffic.value},t(JSON.stringify(o)))}function cleanMap(){map&&(pinMarker&&(pinMarker.setMap(null),pinMarker=null),userType===SHAPE_TYPES.PASSENGER&&driverMarker?(driverMarker.setMap(null),driverMarker=null,cleanDriverShapes()):userType===SHAPE_TYPES.DRIVER&&passengerMarker&&(passengerMarker.setMap(null),passengerMarker=null))}async function storeNearbyDriversLocations(t){let r=!1;if(storedDriversLocations)storedDriversLocations=t;else{var n=[];for(let o=0;o<t.length;o++){for(let e=0;e<storedDriversLocations.length;e++)if(storedDriversLocations[e][0]===t[o][0]&&storedDriversLocations[e][1]===t[o][1]&&storedDriversLocations[e][3]===t[o][3]){n.push(storedDriversLocations[e]),r=!0;break}r||n.push(t[o]),r=!1}storedDriversLocations=n}if(driverMarkers.length){var e,a=[];for(let o=0;o<driverMarkers.length;o++){for(let e=0;e<storedDriversLocations.length;e++)if(driverMarkers[o].get("id")===storedDriversLocations[e][3]){a.push(driverMarkers[o]),r=!0;break}r||driverMarkers[o].setMap(null),r=!1}driverMarkers=a,r=!1;for(let o=a.length=0;o<storedDriversLocations.length;o++){for(let e=0;e<driverMarkers.length;e++)if(storedDriversLocations[o][3]===driverMarkers[e].get("id")){var i=new google.maps.LatLng(storedDriversLocations[o][0],storedDriversLocations[o][1]);updateMarkerPosition(driverMarkers[e],i),a.push(driverMarkers[e]),r=!0;break}r||(e=new google.maps.LatLng(storedDriversLocations[o][0],storedDriversLocations[o][1]),(e=createShape(SHAPE_TYPES.DRIVER,e)).set("id",storedDriversLocations[o][3]),a.push(e)),r=!1}driverMarkers=a}else for(let e=0;e<storedDriversLocations.length;e++){var o=new google.maps.LatLng(storedDriversLocations[e][0],storedDriversLocations[e][1]);(o=createShape(SHAPE_TYPES.DRIVER,o)).set("id",storedDriversLocations[e][3]),driverMarkers.push(o)}}let autocomplete=null,searchInputId=null;function cleanSearchVariables(){document.querySelectorAll(".pac-container").forEach(e=>{e.remove()}),autocomplete=null,searchInputId=null}function searchSetup(e,o,p){var t;null!=autocomplete&&searchInputId==e.id||(document.querySelectorAll(".pac-container").forEach(e=>{e.remove()}),searchInputId=e.id,t={strictBounds:!1,componentRestrictions:{country:"sv"}},autocomplete=new google.maps.places.Autocomplete(e,t)),autocomplete.addListener("place_changed",()=>{var e=autocomplete.getPlace();console.log("Place google.maps.places.Autocomplete: ",e);let o="undefined",t="undefined",r="undefined",n,a="undefined",i="undefined",s="undefined",l="undefined";n=sortFormatAddress(e.formatted_address),e.address_components.map(e=>{e.types.some(e=>"country"===e)&&(o=e.long_name,t=e.short_name),e.types.some(e=>"administrative_area_level_1"===e)&&(r=e.long_name),e.types.some(e=>"street_number"===e||"route"===e)&&(l+=e.long_name+" "),e.types.some(e=>"locality"===e||"administrative_area_level_2"===e)&&(i=e.long_name,a=e.long_name),s=e.types.some(e=>"sublocality_level"===e||"sublocality"===e)?e.long_name:""}),e=new google.maps.Data.Feature({geometry:new google.maps.Data.Point(e.geometry.location),id:e.place_id,properties:{address:{country:o,country_code:t,country_subdivision:r,freeform_address:n,local_name:a,municipality:i,city:s,street_name:l},type:e.types[0],poi:{name:e.name}}});let u;e.toGeoJson(e=>{u=JSON.stringify(e),console.log(u),p(u)})})}function getRoutesTravelTime(o,e){var t=[];if(storedDriversLocations.length){for(let e=0;e<storedDriversLocations.length;e++)0===storedDriversLocations[e][2]&&requestDriversTravelTime(o,storedDriversLocations),t.push(storedDriversLocations[e][2]);return t}if(e){for(var r=0;r<e.length;r++)t.push(e[r][2]);return t}return[]}async function requestDriversTravelTime(o,t){if(t.length)for(let e=0;e<t.length;e++){var r,n;0===t[e][2]&&({rows:r,status:n}=await distanceService.getDistanceMatrix({origins:[new google.maps.LatLng(o.latitude,o.longitude)],destinations:[new google.maps.LatLng(t[e][0],t[e][1])],travelMode:google.maps.TravelMode.DRIVING,durationInTraffic:!0}),"OK"===r[0].elements[0].status?t[e][2]=r[0].elements[0].duration_in_traffic.value:t[e][2]=-1)}}function cleanDriverShapes(){driverMarkers.length&&(driverMarkers.forEach(e=>e.setMap(null)),driverMarkers=[])}function setPickupPointMarker(e,o){VIEW_TYPES.VIEW_ROUTE==viewType&&(follow=!1,followRoute=!0),e=new google.maps.LatLng(e[0],e[1]),o={path:"M12 0c-4.198 0-8 3.403-8 7.602 0 6.243 6.377 6.903 8 16.398 1.623-9.495 8-10.155 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.342-3 3-3 3 1.343 3 3-1.343 3-3 3z",strokeColor:o,strokeOpacity:1,strokeWeight:2,fillColor:o,fillOpacity:1,scale:1.2,origin:new google.maps.Point(0,0),scaledSize:new google.maps.Size(25,25),anchor:new google.maps.Point(12,24)},map&&(insertPickupPointMarker?(insertPickupPointMarker.setIcon(o),insertPickupPointMarker.setPosition(e)):insertPickupPointMarker=new google.maps.Marker({position:e,icon:o,map:map}))}function delPickupPointMarker(){null!=insertPickupPointMarker&&(insertPickupPointMarker.setMap(null),insertPickupPointMarker=null)}function setDestinationPointMarker(e,o){VIEW_TYPES.VIEW_ROUTE==viewType&&(follow=!1,followRoute=!0),e=new google.maps.LatLng(e[0],e[1]),o={path:"M12 0c-4.198 0-8 3.403-8 7.602 0 6.243 6.377 6.903 8 16.398 1.623-9.495 8-10.155 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.342-3 3-3 3 1.343 3 3-1.343 3-3 3z",strokeColor:o,strokeOpacity:1,strokeWeight:2,fillColor:o,fillOpacity:1,scale:1.2,origin:new google.maps.Point(0,0),scaledSize:new google.maps.Size(25,25),anchor:new google.maps.Point(12,24)},map&&(insertDestinationPointMarker?(insertDestinationPointMarker.setIcon(o),insertDestinationPointMarker.setPosition(e)):insertDestinationPointMarker=new google.maps.Marker({position:e,icon:o,map:map}))}function delDestinationPointMarker(){null!=insertDestinationPointMarker&&(insertDestinationPointMarker.setMap(null),insertDestinationPointMarker=null)}export{map,driverMarker,passengerMarker,follow,followRoute,prevRouteBegin,prevRouteEnd,searchBox,getCountResquestservice,resetCountResquestservice,setMapToNull,showPanelDirection,removePanelDirection,showPickupPointCircle,removePickupPointCircle,LaunchWazeRoute,LaunchGMapsRoute,followUser,getPlaceInfoFromCoordinates,renderMap,setPinPointMarker,delPinPointMarker,showPinMarker,hidePassengerMarker,showPassengerMarker,setPrecisionPin,cleanPrecisionPin,updatePassengerMarkerPosition,updateDriverMarkerPosition,getRouteDistanceAndTime,updateRouteJS,updateRoute,focusUser,setMapBounds,focusRoute,enableRotateMap,disableRotateMap,getRouteDistance,getTravelTime,getRouteTravelTimeWithCallback,cleanMap,storeNearbyDriversLocations,cleanSearchVariables,searchSetup,getRoutesTravelTime,requestDriversTravelTime,cleanDriverShapes,setPickupPointMarker,delPickupPointMarker,setDestinationPointMarker,delDestinationPointMarker};