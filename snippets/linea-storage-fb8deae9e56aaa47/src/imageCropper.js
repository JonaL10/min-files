let editor=null,miCanvas=null,contexto=null,maxWidth=480,maxHeight=480,quality=1,maxSize=null,scaleRatio=1,resultCallback=null,resultBase64Callback=null,onInputChange=null,imgFile=null,imgFileRescaledUrl=null,rescale=!0,currentSnipUrl=null,inputImage=null,imageBase64=null,lastblobType=null,cameraDirection=1,camera={takePhoto:function(){var e;navigator.camera&&(e={quality:80,destinationType:0,sourceType:1,mediaType:0,encodingType:0,cameraDirection:cameraDirection,targetWidth:maxWidth,targetHeight:maxHeight},navigator.camera.getPicture(camera.onSuccess,camera.onError,e))},onSuccess:function(e){console.log("~ onSuccess ~ imgURI","data:image/jpeg;base64,",e),imageBase64=e,"profile"==lastblobType||"vehicle"==lastblobType?rescaleImgFromUrl("data:image/jpeg;base64,"+e,null,function(e){imgFileRescaledUrl=e},onInputChange):onInputChange()},onError:function(e){console.log("error al obtener img: ",e)}};function changeCameraDirection(e){cameraDirection=e}function expectFileFromCamera(e,t){lastblobType=t,onInputChange=e,initializeRescaler(t),camera.takePhoto()}function saveFile(e){0!=e.target.files.length?(imgFile=e.target.files[0],rescaleImgFromUrl(URL.createObjectURL(imgFile),null,function(e){imgFileRescaledUrl=e},onInputChange)):imgFile=null}function expectFileFromImage(e,t){var a="#image-"+(lastblobType=t);(inputImage=document.querySelector(a)).addEventListener("change",saveFile,!1),onInputChange=e,initializeRescaler(t)}function initCropper(e,t){resultCallback=e,resultBase64Callback=t,rescale=!0,startCroppr(imgFileRescaledUrl)}function startCroppr(t){var e;editor=document.querySelector("#editor"),miCanvas=document.querySelector("#preview"),contexto=miCanvas.getContext("2d"),currentSnipUrl=null,editor&&miCanvas&&contexto&&t&&((e=new Image).onload=function(){editor.innerHTML="";var e=document.createElement("img");e.setAttribute("id","croppr"),document.getElementById("editor").appendChild(e),contexto.clearRect(0,0,miCanvas.width,miCanvas.height),document.querySelector("#croppr").setAttribute("src",t),new Croppr("#croppr",{aspectRatio:scaleRatio,onInitialize:onInitialize,onCropEnd:recortarImagen})},e.src=t)}function onInitialize(e){console.log(e),isNaN(e.getValue().width)?startCroppr(imgFileRescaledUrl):recortarImagen(e.getValue())}function recortarImagen(t){if(console.log(t),miCanvas&&contexto){const a=t.x,o=t.y,i=t.width,r=t.height;miCanvas.width=i,miCanvas.height=r;let e=new Image;e.onload=function(){contexto.drawImage(e,a,o,i,r,0,0,i,r),currentSnipUrl=miCanvas.toDataURL("image/png"),1==rescale&&(rescaleCurrentSnip(),rescale=!1)},e.src=imgFileRescaledUrl}}function initializeRescaler(e){scaleRatio="profile"==e?(maxWidth=480,maxHeight=480,1):(maxWidth=640,maxHeight=480,.75)}function getPhotoBytes(e,t){imageBase64&&convertImgBase64toBytes(e,imageBase64,t)}function convertImgBase64toBytes(e,t,a){initializeRescaler(e),rescaleImgFromUrl("data:image/png;base64,"+t,a,null,null)}function rescaleCurrentSnip(){rescaleImgFromUrl(currentSnipUrl,resultCallback,resultBase64Callback,null)}function rescaleImgFromUrl(e,a,o,i){if(e){let t=new Image;t.onload=function(){var e=scaleImage(t);a&&getBlobfromUrl(e,a),o&&o(e),i&&i()},t.src=e}}function getBlobfromUrl(e,t){fetch(e).then(function(e){return e.blob()}).then(function(e){getBlobArrayBuffer(e,t)})}async function getBlobArrayBuffer(e,t){null!=e&&(e=await e.arrayBuffer(),e=new Uint8Array(e),t)&&t(e)}let scaleImage=function(e){var t=document.createElement("canvas"),a=(t.width=e.width,t.height=e.height,t.getContext("2d")),e=(a.save(),a.drawImage(e,0,0),a.restore(),t.width/t.height),o=Math.min(maxWidth,e*maxHeight);for(0<maxSize&&maxSize<t.width*t.height/1e6&&(o=Math.min(o,Math.floor(1e3*Math.sqrt(maxSize*e)))),(o=scaleRatio?Math.min(o,Math.floor(scaleRatio*t.width)):o)<=0&&(o=1);t.width>=2*o;)t=getHalfScaleCanvas(t);return(t=t.width>o?scaleCanvasWithAlgorithm(t,o):t).toDataURL("image/png",quality)};function rotateImageOnEditor(){let e=new Image;e.onload=function(){startCroppr(imgFileRescaledUrl=rotateImage(e))},e.src=imgFileRescaledUrl}let rotateImage=function(e){var t=document.createElement("canvas"),a=t.getContext("2d");return a.save(),t.width=e.height,t.height=e.width,a.rotate(90*Math.PI/180),a.translate(0,-t.width),a.drawImage(e,0,0),a.restore(),t.toDataURL("image/png",quality)},scaleCanvasWithAlgorithm=function(e,t){var a=document.createElement("canvas"),t=t/e.width,e=(a.width=e.width*t,a.height=e.height*t,e.getContext("2d").getImageData(0,0,e.width,e.height)),o=a.getContext("2d").createImageData(a.width,a.height);return applyBilinearInterpolation(e,o,t),a.getContext("2d").putImageData(o,0,0),a},getHalfScaleCanvas=function(e){var t=document.createElement("canvas");return t.width=e.width/2,t.height=e.height/2,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t},applyBilinearInterpolation=function(e,t,a){function o(e,t,a,o,i,r){var n=1-i,l=1-r;return e*n*l+t*i*l+a*n*r+o*i*r}for(var i,r,n,l,c,s,m,d,g,u,h,p,v=0;v<t.height;++v)for(r=v/a,n=Math.floor(r),l=Math.ceil(r)>e.height-1?e.height-1:Math.ceil(r),i=0;i<t.width;++i)u=i/a,h=Math.floor(u),g=Math.ceil(u)>e.width-1?e.width-1:Math.ceil(u),c=4*(i+t.width*v),s=4*(h+e.width*n),m=4*(g+e.width*n),d=4*(h+e.width*l),g=4*(g+e.width*l),p=o(e.data[s],e.data[m],e.data[d],e.data[g],u-=h,h=r-n),t.data[c]=p,p=o(e.data[1+s],e.data[1+m],e.data[1+d],e.data[1+g],u,h),t.data[1+c]=p,p=o(e.data[2+s],e.data[2+m],e.data[2+d],e.data[2+g],u,h),t.data[2+c]=p,p=o(e.data[3+s],e.data[3+m],e.data[3+d],e.data[3+g],u,h),t.data[3+c]=p};function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}let streamVideoCamera=null;function verifyPermissionCamera(t){navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{streamVideoCamera=e,t(!0)}).catch(e=>{t(!1),console.log("Error al obtener acceso a la cámara web:",e)})}function stopStreamCamera(){null!=streamVideoCamera&&(streamVideoCamera.getTracks().forEach(e=>e.stop()),streamVideoCamera=null)}let videoCamera=null;const size_width=680,size_height=480;function startVideoCameraPC(t){if(videoCamera=document.getElementById("video-viewer")){videoCamera.width=size_width,videoCamera.height=size_height,null!=streamVideoCamera?(videoCamera.srcObject=streamVideoCamera,videoCamera.play()):navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{streamVideoCamera=e,videoCamera.srcObject=e,videoCamera.play()}).catch(e=>{console.log("Error al obtener acceso a la cámara web:",e)});var e=document.getElementById("btn-take-picture");const a=document.getElementById("canvas-preview");e&&a&&(a.width=size_width,a.height=size_height,e.addEventListener("click",()=>{a.getContext("2d").drawImage(videoCamera,0,0,videoCamera.videoWidth,videoCamera.videoHeight,0,0,size_width,size_height);var e=a.toDataURL();console.log(e),t(e),console.log("GETVALUEBASE64FN",videoCamera),console.log("GETVALUEBASE64FN",videoCamera.videoWidth),console.log("GETVALUEBASE64FN",videoCamera.videoHeight),setTimeout(()=>{displayImgGetBase64()},"500")}))}}let getBase64Croppr=null,getVecu8Croppr=null;function displayImgGetBase64(){var e=document.querySelectorAll(".side-controls-shifter svg"),t=document.querySelector(".side-control-page-1"),a=document.querySelector(".side-control-page-2"),o=document.querySelectorAll(".action-button button"),i=document.querySelectorAll(".side-control-page-1 .zoom span"),r=document.querySelectorAll(".side-control-page-1 .rotate span"),n=document.querySelectorAll(".side-control-page-1 .flip svg"),l=document.querySelectorAll(".side-control-page-1 .move svg"),c=(document.querySelectorAll(".side-control-page-2 .aspect li"),document.querySelectorAll(".bottom-control .ctrl-cropper svg")),s=document.querySelectorAll(".bottom-control .lock svg"),m=document.querySelectorAll(".bottom-control .drag-mode svg"),d=(document.getElementById("btn-take-picture"),e[0].onclick=()=>{t.style.display="block",a.style.display="none",e[0].classList.add("active"),e[1].classList.remove("active")},e[1].onclick=()=>{t.style.display="none",a.style.display="block",e[0].classList.remove("active"),e[1].classList.add("active")},document.querySelector(".image-workspace").innerHTML='<img src="" alt="">',document.querySelector(".image-workspace img")),g=document.getElementById("getWorkspaceImg").getAttribute("src"),g=(d.src=g,{dragMode:"move",preview:".img-preview",viewMode:2,modal:!1,background:!1,ready:function(){i[0].onclick=()=>u.zoom(.1),i[1].onclick=()=>u.zoom(-.1),r[0].onclick=()=>u.rotate(45),r[1].onclick=()=>u.rotate(-45);var e=-1,t=-1;n[0].onclick=()=>{u.scale(e,1),e=-e},n[1].onclick=()=>{u.scale(1,t),t=-t},l[0].onclick=()=>u.move(0,-1),l[1].onclick=()=>u.move(-1,0),l[2].onclick=()=>u.move(1,0),l[3].onclick=()=>u.move(0,1),u.setAspectRatio(1),c[0].onclick=()=>u.clear(),c[1].onclick=()=>u.crop(),s[0].onclick=()=>u.disable(),s[1].onclick=()=>u.enable(),m[0].onclick=()=>u.setDragMode("crop"),m[1].onclick=()=>u.setDragMode("move"),o[3].onclick=()=>{getBase64Croppr=u.getCroppedCanvas().toDataURL(),u.getCroppedCanvas().toBlob(e=>{var t=new FileReader;t.onloadend=function(){getVecu8Croppr=new Uint8Array(t.result),console.log(getVecu8Croppr)},t.readAsArrayBuffer(e)},"image.png")}}}),u=new Cropper(d,g)}function getBase64ImgString(){return getBase64Croppr}function getVecu8Img(){return getVecu8Croppr}export{changeCameraDirection,expectFileFromCamera,expectFileFromImage,initCropper,getPhotoBytes,convertImgBase64toBytes,rescaleCurrentSnip,rotateImageOnEditor,isMobileDevice,verifyPermissionCamera,stopStreamCamera,startVideoCameraPC,displayImgGetBase64,getBase64ImgString,getVecu8Img};